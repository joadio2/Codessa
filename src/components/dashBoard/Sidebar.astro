---
/* Sidebar.astro */
const menuItems = [
  { name: 'Dashboard', icon: 'dashboard', href: '/dashboard' },
  { name: 'Analytics', icon: 'analytics', href: '/dashboard/analytics' },
  { name: 'Projects', icon: 'projects', href: '/dashboard/projects' },
  { name: 'Tasks', icon: 'tasks', href: '/dashboard/tasks' },
  { name: 'Team', icon: 'team', href: '/dashboard/team' },
  { name: 'Settings', icon: 'settings', href: '/dashboard/settings' },
];

const currentPath = Astro.url.pathname;
const normalizedPath = currentPath.replace(/^\/(es|en)(?=\/|$)/, '');

// Helper para marcar activo por coincidencia exacta o por prefijo
function bestMatch(path:any, items:any) {
  const matches = items.filter(({ href }) => {
    if (href === '/') return path === '/';
    return path === href || path.startsWith(href + '/');
  });
  return matches.sort((a, b) => b.href.length - a.href.length)[0]?.href;
}

const activeHref = bestMatch(normalizedPath, menuItems);
---
<aside class="sidebar">
  <div class="sidebar-header">
    <div class="logo">
      <svg width="32" height="32" viewBox="0 0 32 32" fill="none" aria-hidden="true">
        <rect width="32" height="32" rx="8" fill="url(#gradient1)"/>
        <path d="M8 12h16v8H8z" fill="white" opacity="0.9"/>
        <defs>
          <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#3B82F6"/>
            <stop offset="100%" stop-color="#1D4ED8"/>
          </linearGradient>
        </defs>
      </svg>
      <span class="logo-text">SaaSPro</span>
    </div>
  </div>
  
  <nav class="sidebar-nav" aria-label="Sidebar">
    <ul class="nav-list">
      {menuItems.map(item => {
        const active = item.href === activeHref;
        return (
          <li class="nav-item">
            <a
              href={item.href}
              class={`nav-link ${active ? 'active' : ''}`}
              aria-current={active ? 'page' : undefined}
            >
              <span class="nav-icon" aria-hidden="true">
                {item.icon === 'dashboard' && (
                  <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                  </svg>
                )}
                {item.icon === 'analytics' && (
                  <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"/>
                    <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"/>
                  </svg>
                )}
                {item.icon === 'projects' && (
                  <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z"/>
                  </svg>
                )}
                {item.icon === 'tasks' && (
                  <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                  </svg>
                )}
                {item.icon === 'team' && (
                  <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                  </svg>
                )}
                {item.icon === 'settings' && (
                  <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"/>
                  </svg>
                )}
              </span>
              <span class="nav-text">{item.name}</span>
            </a>
          </li>
        );
      })}
    </ul>
  </nav>
  
  <div class="sidebar-footer">
    <div class="user-info">
      <div class="user-avatar">
        <img src="https://images.pexels.com/photos/1040880/pexels-photo-1040880.jpeg?auto=compress&cs=tinysrgb&w=64&h=64&dpr=1" alt="User avatar" />
      </div>
      <div class="user-details">
        <p class="user-name">Alex Johnson</p>
        <p class="user-email">alex@saaspro.com</p>
      </div>
    </div>
  </div>
</aside>

<style>
  .sidebar {
    width: 280px;
    height: 100vh;
    background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
    border-right: 1px solid #e2e8f0;
    display: flex;
    flex-direction: column;
    position: fixed;
    left: 0;
    top: 0;
    z-index: 100;
    transition: all 0.3s ease;
  }
  .sidebar-header { padding: 24px 20px; border-bottom: 1px solid #f1f5f9; }
  .logo { display: flex; align-items: center; gap: 12px; }
  .logo-text { font-size: 20px; font-weight: 700; color: #1e293b; letter-spacing: -0.02em; }
  .sidebar-nav { flex: 1; padding: 16px 0; }
  .nav-list { list-style: none; padding: 0; margin: 0; }
  .nav-item { margin: 4px 0; }
  .nav-link {
    display: flex; align-items: center; gap: 12px; padding: 12px 20px;
    color: #64748b; text-decoration: none; border-radius: 8px; margin: 0 16px;
    transition: all 0.2s ease; font-weight: 500; font-size: 14px; position: relative; overflow: hidden;
  }
  .nav-link:hover { background: #f1f5f9; color: #3b82f6; transform: translateX(4px); }
  .nav-link.active {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }
  .nav-link.active:hover { transform: translateX(0); background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); }
  .nav-icon { display: flex; align-items: center; justify-content: center; min-width: 20px; }
  .nav-text { white-space: nowrap; }
  .sidebar-footer { padding: 20px; border-top: 1px solid #f1f5f9; }
  .user-info { display: flex; align-items: center; gap: 12px; }
  .user-avatar { width: 40px; height: 40px; border-radius: 50%; overflow: hidden; border: 2px solid #e2e8f0; }
  .user-avatar img { width: 100%; height: 100%; object-fit: cover; }
  .user-details { flex: 1; min-width: 0; }
  .user-name { font-size: 14px; font-weight: 600; color: #1e293b; margin: 0 0 2px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .user-email { font-size: 12px; color: #64748b; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  @media (max-width: 768px) {
    .sidebar { transform: translateX(-100%); width: 280px; }
    .sidebar.open { transform: translateX(0); }
  }
</style>